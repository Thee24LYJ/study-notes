[Makefile 基础学习 | Thee](https://www.theelyj.com/2022/12/28/Makefile%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0/)
[Makefile 基础 - Makefile 教程 - 廖雪峰的官方网站](https://liaoxuefeng.com/books/makefile/makefile-basic/index.html)
[不懂 Makefile 的程序员还敢写代码吗？](https://mp.weixin.qq.com/s/tKYuRfHfgnWvcq5VcDnrQw)
[Makefile \| 爱编程的大丙](https://subingwen.cn/linux/makefile/)

# 规则

`Makefile` 是用来描述哪些文件需要编译、哪些文件需要重新编译的文件(实现文件编译和链接)，其格式如下：

```Makefile
目标1,目标2... : 依赖文件集合...
	命令1
	命令2
	...
```

构建项目的时候在哪个目录下执行构建命令 make 这个目录下的 makefile 文件就会别加载，因此在一个项目中可以有多个 makefile 文件，分别位于不同的项目目录中

# 工作原理

规则执行：在调用 make 命令编译程序的时候，make 会首先找到 Makefile 文件中的第 1 个规则，分析并执行相关的动作

make 命令执行的时候会根据文件的时间戳判定是否执行 makefile 文件中相关规则中的命令

- `目标时间戳 > 所有依赖的时间戳`：规则中的命令就不会被执行
- `目标时间戳 < 某些依赖的时间戳`：重新生成目标文件
- 目标文件不存在：重新生成目标文件

# 变量

### 自定义变量

```
# 自定义变量
变量名=变量值

# 使用自定义变量
$(变量名)
```

# 预定义变量

AR、AS、CC、CPP、CXX、FC、RM 等

### 自动变量

自动变量用来代表这些规则中的目标文件和依赖文件，并且它们只能在规则的命令中使用

| 变 量 |                                         含 义                                          |
| :---: | :------------------------------------------------------------------------------------: |
|  $\*  |                       表示目标文件的名称，不包含目标文件的扩展名                       |
|  $+   | 表示所有依赖文件，依赖文件之间以空格分开，按照出现先后顺序，其中可能包含重复的依赖文件 |
|  $<   |                            表示依赖项中第一个依赖文件的名称                            |
|  $?   |           依赖项中，所有比目标文件时间戳晚的依赖文件，依赖文件之间以空格分开           |
|  $@   |                           表示目标文件的名称，包含文件扩展名                           |
|  $^   |                 依赖项中，所有不重复的依赖文件，这些文件之间以空格分开                 |

# 函数

makefile 中有很多函数并且所有的函数都是有返回值的

```
$(函数名 参数1, 参数2, 参数3, ...)
```

```
# 该函数主要作用是获取指定目录下指定类型的文件名，其返回值是以空格分割的、指定目录下的所有符合条件的文件名列表
# 该函数参数只有一个, 但是该参数可以分成若干个部分, 通过空格间隔
$(wildcard PATTERN...)
	参数: 指定某个目录, 搜索这个路径下指定类型的文件，比如： *.c


# 该函数按照指定的模式替换指定的文件名的后缀
# 有三个参数, 参数之间使用 逗号间隔
$(patsubst <pattern>,<replacement>,<text>)
```

Makefile 声明一个伪目标需要使用`.PHONY`关键字, 声明方式为: `.PHONY:伪文件名称`
