[Linux 静态库和动态库 \| 爱编程的大丙](https://subingwen.cn/linux/library/)

# 一、静态库

静态库生成：`ar`程序生成

```bash
$ gcc -c xx.c
$ ar rcs libxx.a xx.o
```

- 在 Linux 中静态库以 lib 作为前缀, 以.a 作为后缀, 中间是库的名字自己指定即可, 即: libxxx.a
- 在 Windows 中静态库一般以 lib 作为前缀, 以 lib 作为后缀, 中间是库的名字需要自己指定, 即: libxxx.lib

Linux 生成静态链接库：

- 先对源文件进行汇编操作 (使用参数 -c) 得到二进制格式的目标文件 (.o 格式)
- 通过 ar 工具将目标文件打包就可以得到静态库文件了 (libxxx.a)

ar 工具创建静态库的时候需要三个参数:

- 参数 c：创建一个库，不管库是否存在，都将创建
- 参数 s：创建目标文件索引，这在创建较大的库时能加快时间
- 参数 r：在库中插入模块(替换)。默认新的成员添加在库的结尾处，如果模块名已经在库中存在，则替换同名的模块

使用静态库(提供头文件和对应静态库)：
编译时指定静态库路径及名字

- -L: 指定库所在的目录(相对或者绝对路径)
- -l: 指定库的名字, 需要掐头(lib)去尾(.a) 剩下的才是需要的静态库的名称

# 二、动态库

> 动态链接库是程序运行时加载的库，当动态链接库正确部署之后，运行的多个程序可以使用同一个加载到内存中的动态库，因此在 Linux 中动态链接库也可称之为共享库
> 动态链接库是目标文件的集合，目标文件在动态链接库中的组织方式是按照特殊方式形成的。库中函数和变量的地址使用的是相对地址（静态库中使用的是绝对地址），其真实地址是在应用程序加载动态库时形成的

- 在 Linux 中动态库以 lib 作为前缀, 以.so 作为后缀, 中间是库的名字自己指定即可, 即: libxxx.so
- 在 Windows 中动态库一般以 lib 作为前缀, 以 dll 作为后缀, 中间是库的名字需要自己指定, 即: libxxx.dll

动态库生成：使用 gcc 命令并且需要添加-fPIC（-fpic） 以及-shared 参数

- -fPIC 或 -fpic 参数的作用是使得 gcc 生成的代码是与位置无关的，也就是使用相对位置
- -shared 参数的作用是告诉编译器生成一个动态链接库

```bash
$ gcc xxx.c -c -fpic
$ gcc -shared xxx.o -o libxxx.so
```

**使用动态库时与使用静态库方法相同，也需要提供动态库路径和名称**

ldd 命令可以检测程序能不能够通过动态链接器加载到对应的动态库

# 三、静态库与动态库优缺点

### 静态库

##### 优点

- 静态库被打包到应用程序中加载速度快
- 发布程序无需提供静态库，移植方便

##### 缺点

- 相同的库文件数据可能在内存中被加载多份, 消耗系统资源，浪费内存
- 库文件更新需要重新编译项目文件, 生成新的可执行程序, 浪费时间

### 动态库

##### 优点

- 可实现不同进程间的资源共享
- 动态库升级简单, 只需要替换库文件, 无需重新编译应用程序
- 可以控制何时加载动态库, 不调用库函数时动态库不会被加载

##### 缺点

- 加载速度比静态库慢, 以现在计算机的性能可以忽略
- 发布程序需要提供依赖的动态库
